/*!
 * wordcloud2.js
 * http://timdream.org/wordcloud2.js/
 *
 * Copyright 2011 - 2013 Tim Chien
 * Released under the MIT license
 */
"use strict";if(!window.setImmediate){window.setImmediate=(function setupSetImmediate(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||(function a(){if(!window.postMessage||!window.addEventListener){return null}var f=[undefined];var e="zero-timeout-message";var d=function d(i){var h=f.length;f.push(i);window.postMessage(e+h.toString(36),"*");return h};window.addEventListener("message",function g(h){if(typeof h.data!=="string"||h.data.substr(0,e.length)!==e){return}h.stopImmediatePropagation();var i=parseInt(h.data.substr(e.length),36);if(!f[i]){return}f[i]();f[i]=undefined},true);window.clearImmediate=function c(h){if(!f[h]){return}f[h]=undefined};return d})()||function b(c){window.setTimeout(c,0)}})()}if(!window.clearImmediate){window.clearImmediate=(function setupClearImmediate(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function a(b){window.clearTimeout(b)}})()}(function(d){var c=(function c(){var h=document.createElement("canvas");if(!h||!h.getContext){return false}var g=h.getContext("2d");if(!g.getImageData){return false}if(!g.fillText){return false}if(!Array.prototype.some){return false}if(!Array.prototype.push){return false}return true}());var b=(function f(){if(!c){return}var g=document.createElement("canvas").getContext("2d");var i=20;var j,h;while(i){g.font=i.toString(10)+"px sans-serif";if((g.measureText("\uFF37").width===j)&&(g.measureText("m").width)===h){return(i+1)}j=g.measureText("\uFF37").width;h=g.measureText("m").width;i--}return 0})();var e=function e(h){for(var k,g,l=h.length;l;k=Math.floor(Math.random()*l),g=h[--l],h[l]=h[k],h[k]=g){}return h};var a=function a(j,z){if(!c){return}if(!Array.isArray(j)){j=[j]}j.forEach(function(Y,g){if(typeof Y==="string"){j[g]=document.getElementById(Y);if(!j[g]){throw"The element id specified is not found."}}else{if(!Y.tagName&&!Y.appendChild){throw"You must pass valid HTML elements, or ID of the element."}}});var U={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:true,backgroundColor:"#fff",gridSize:8,origin:null,drawMask:false,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:0.3,wait:0,abortThreshold:0,abort:function T(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,shuffle:true,rotateRatio:0.1,shape:"circle",ellipticity:0.65,hover:null,click:null};if(z){for(var u in z){if(u in U){U[u]=z[u]}}}if(typeof U.weightFactor!=="function"){var S=U.weightFactor;U.weightFactor=function K(g){return g*S}}if(typeof U.shape!=="function"){switch(U.shape){case"circle":default:U.shape="circle";break;case"cardioid":U.shape=function q(g){return 1-Math.sin(g)};break;case"diamond":case"square":U.shape=function J(g){var Y=g%(2*Math.PI/4);return 1/(Math.cos(Y)+Math.sin(Y))};break;case"triangle-forward":U.shape=function L(g){var Y=g%(2*Math.PI/3);return 1/(Math.cos(Y)+Math.sqrt(3)*Math.sin(Y))};break;case"triangle":case"triangle-upright":U.shape=function L(g){var Y=(g+Math.PI*3/2)%(2*Math.PI/3);return 1/(Math.cos(Y)+Math.sqrt(3)*Math.sin(Y))};break;case"pentagon":U.shape=function s(g){var Y=(g+0.955)%(2*Math.PI/5);return 1/(Math.cos(Y)+0.726543*Math.sin(Y))};break;case"star":U.shape=function r(g){var Y=(g+0.955)%(2*Math.PI/10);if((g+0.955)%(2*Math.PI/5)-(2*Math.PI/10)>=0){return 1/(Math.cos((2*Math.PI/10)-Y)+3.07768*Math.sin((2*Math.PI/10)-Y))}else{return 1/(Math.cos(Y)+3.07768*Math.sin(Y))}};break}}U.gridSize=Math.max(U.gridSize,4);var V=U.gridSize;var P=V-U.maskGapWidth;var p=Math.abs(U.maxRotation-U.minRotation);var t=Math.min(U.maxRotation,U.minRotation);var N,w,v,i,I;var O;var Q;switch(U.color){case"random-dark":Q=function H(){return"rgb("+Math.floor(Math.random()*128).toString(10)+","+Math.floor(Math.random()*128).toString(10)+","+Math.floor(Math.random()*128).toString(10)+")"};break;case"random-light":Q=function X(){return"rgb("+Math.floor(Math.random()*128+128).toString(10)+","+Math.floor(Math.random()*128+128).toString(10)+","+Math.floor(Math.random()*128+128).toString(10)+")"};break;default:if(typeof U.color==="function"){Q=U.color}break}var m=false;var x=[];var D;var k=function k(Y){var Z=Y.target;var aa=Z.getBoundingClientRect();var ac=Y.clientX-aa.left;var ab=Y.clientY-aa.top;var g=Math.floor(ac*(Z.width/aa.width)/V);var ad=Math.floor(ab*(Z.height/aa.height)/V);return x[g][ad]};var l=function l(g){var Y=k(g);if(D===Y){return}D=Y;if(!Y){U.hover(undefined,undefined,g);return}U.hover(Y.item,Y.dimension,g)};var B=function B(g){var Y=k(g);if(!Y){return}U.click(Y.item,Y.dimension,g)};var R=[];var M=function M(g){if(R[g]){return R[g]}var Y=g*8;var Z=Y;var aa=[];if(g===0){aa.push([i[0],i[1],0])}while(Z--){var ab=1;if(U.shape!=="circle"){ab=U.shape(Z/Y*2*Math.PI)}aa.push([i[0]+g*ab*Math.cos(-Z/Y*2*Math.PI),i[1]+g*ab*Math.sin(-Z/Y*2*Math.PI)*U.ellipticity,Z/Y*2*Math.PI])}R[g]=aa;return aa};var G=function G(){return((U.abortThreshold>0)&&((new Date()).getTime()-O>U.abortThreshold))};var y=function y(){if(U.rotateRatio===0){return 0}if(Math.random()>U.rotateRatio){return 0}if(p===0){return t}return t+Math.random()*p};var o=function o(ax,al,am){var ar=false;var g=U.weightFactor(al);if(g<=U.minSize){return false}var au=1;if(g<b){au=(function ab(){var aA=2;while(aA*g<b){aA+=2}return aA})()}var ap=document.createElement("canvas");var ay=ap.getContext("2d",{willReadFrequently:true});ay.font=U.fontWeight+" "+(g*au).toString(10)+"px "+U.fontFamily;var Y=ay.measureText(ax).width/au;var ak=Math.max(g*au,ay.measureText("m").width,ay.measureText("\uFF37").width)/au;var ag=Y+ak*2;var ae=ak*3;var az=Math.ceil(ag/V);var Z=Math.ceil(ae/V);ag=az*V;ae=Z*V;var aq=-Y/2;var an=-ak*0.4;var at=Math.ceil((ag*Math.abs(Math.sin(am))+ae*Math.abs(Math.cos(am)))/V);var aa=Math.ceil((ag*Math.abs(Math.cos(am))+ae*Math.abs(Math.sin(am)))/V);var av=aa*V;var ao=at*V;ap.setAttribute("width",av);ap.setAttribute("height",ao);if(ar){document.body.appendChild(ap)}ay.save();ay.scale(1/au,1/au);ay.translate(av*au/2,ao*au/2);ay.rotate(-am);ay.font=U.fontWeight+" "+(g*au).toString(10)+"px "+U.fontFamily;ay.fillStyle="#000";ay.textBaseline="middle";ay.fillText(ax,aq*au,(an+g*0.5)*au);ay.restore();var aw=ay.getImageData(0,0,av,ao).data;if(G()){return false}var ad=[];var aj=aa,ai,ah,af;var ac=[at/2,aa/2,at/2,aa/2];while(aj--){ai=at;while(ai--){af=V;singleGridLoop:{while(af--){ah=V;while(ah--){if(aw[((ai*V+af)*av+(aj*V+ah))*4+3]){ad.push([aj,ai]);if(aj<ac[3]){ac[3]=aj}if(aj>ac[1]){ac[1]=aj}if(ai<ac[0]){ac[0]=ai}if(ai>ac[2]){ac[2]=ai}if(ar){ay.fillStyle="rgba(255, 0, 0, 0.5)";ay.fillRect(aj*V,ai*V,V-0.5,V-0.5)}break singleGridLoop}}}if(ar){ay.fillStyle="rgba(0, 0, 255, 0.5)";ay.fillRect(aj*V,ai*V,V-0.5,V-0.5)}}}}if(ar){ay.fillStyle="rgba(0, 255, 0, 0.5)";ay.fillRect(ac[3]*V,ac[0]*V,(ac[1]-ac[3]+1)*V,(ac[2]-ac[0]+1)*V)}return{mu:au,occupied:ad,bounds:ac,gw:aa,gh:at,fillTextOffsetX:aq,fillTextOffsetY:an,fillTextWidth:Y,fillTextHeight:ak,fontSize:g}};var C=function C(ad,ac,ae,Y,g){var ab=g.length;while(ab--){var aa=ad+g[ab][0];var Z=ac+g[ab][1];if(aa>=w||Z>=v||aa<0||Z<0||!N[aa][Z]){return false}}return true};var h=function h(ah,ag,ab,Z,ae,Y,aa,af){var ai=ab.fontSize;var ac;if(Q){ac=Q(Z,ae,ai,Y,aa)}else{ac=U.color}var ad;var g=ab.bounds;ad={x:(ah+g[3])*V,y:(ag+g[0])*V,w:(g[1]-g[3]+1)*V,h:(g[2]-g[0]+1)*V};j.forEach(function(an){if(an.getContext){var ak=an.getContext("2d");var aj=ab.mu;ak.save();ak.scale(1/aj,1/aj);ak.font=U.fontWeight+" "+(ai*aj).toString(10)+"px "+U.fontFamily;ak.fillStyle=ac;ak.translate((ah+ab.gw/2)*V*aj,(ag+ab.gh/2)*V*aj);if(af!==0){ak.rotate(-af)}ak.textBaseline="middle";ak.fillText(Z,ab.fillTextOffsetX*aj,(ab.fillTextOffsetY+ai*0.5)*aj);ak.restore()}else{var am=document.createElement("span");var ap="";ap="rotate("+(-af/Math.PI*180)+"deg) ";if(ab.mu!==1){ap+="translateX(-"+(ab.fillTextWidth/4)+"px) scale("+(1/ab.mu)+")"}var al={position:"absolute",display:"block",font:U.fontWeight+" "+(ai*ab.mu)+"px "+U.fontFamily,left:((ah+ab.gw/2)*V+ab.fillTextOffsetX)+"px",top:((ag+ab.gh/2)*V+ab.fillTextOffsetY)+"px",width:ab.fillTextWidth+"px",height:ab.fillTextHeight+"px",color:ac,lineHeight:ai+"px",whiteSpace:"nowrap",transform:ap,webkitTransform:ap,msTransform:ap,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};am.textContent=Z;for(var ao in al){am.style[ao]=al[ao]}an.appendChild(am)}})};var n=function n(g,ab,aa,Z,Y){if(g>=w||ab>=v||g<0||ab<0){return}N[g][ab]=false;if(aa){ctx.fillRect(g*V,ab*V,P,P)}if(m){x[g][ab]={item:Y,dimension:Z}}};var W=function W(ag,af,ai,ae,Z,ah){var Y=Z.occupied;var ac=V-U.maskGapWidth;var ad=U.drawMask;if(ad){ctx.save();ctx.fillStyle=U.maskColor}var aa;if(m){var g=Z.bounds;aa={x:(ag+g[3])*V,y:(af+g[0])*V,w:(g[1]-g[3]+1)*V,h:(g[2]-g[0]+1)*V}}var ab=Y.length;while(ab--){n(ag+Y[ab][0],af+Y[ab][1],ad,aa,ah)}if(ad){ctx.restore()}};var E=function E(ag){var Z=ag[0];var ac=ag[1];var ad=y();var aa=o(Z,ac,ad);if(!aa){return false}if(G()){return false}var g=aa.bounds;if((g[1]-g[3]+1)>w||(g[2]-g[0]+1)>v){return false}var Y=I+1;while(Y--){var ae=M(I-Y);if(U.shuffle){ae=[].concat(ae);e(ae)}var ab=ae.some(function af(ai){var ak=Math.floor(ai[0]-aa.gw/2);var aj=Math.floor(ai[1]-aa.gh/2);var al=aa.gw;var ah=aa.gh;if(!C(ak,aj,al,ah,aa.occupied)){return false}h(ak,aj,aa,Z,ac,(I-Y),ai[2],ad);W(ak,aj,al,ah,aa,ag);return true});if(ab){return true}}return false};var F=function F(Z,g,Y){if(g){return !j.some(function(ab){var aa=document.createEvent("CustomEvent");aa.initCustomEvent(Z,true,g,Y||{});return !ab.dispatchEvent(aa)},this)}else{j.forEach(function(ab){var aa=document.createEvent("CustomEvent");aa.initCustomEvent(Z,true,g,Y||{});ab.dispatchEvent(aa)},this)}};var A=function A(){var Y=j[0];if(Y.getContext){w=Math.floor(Y.width/V);v=Math.floor(Y.height/V)}else{var g=Y.getBoundingClientRect();w=Math.floor(g.width/V);v=Math.floor(g.height/V)}if(!F("wordcloudstart",true)){return}i=(U.origin)?[U.origin[0]/V,U.origin[1]/V]:[w/2,v/2];I=Math.floor(Math.sqrt(w*w+v*v));N=[];if(!Y.getContext||U.clearCanvas){j.forEach(function(aq){if(aq.getContext){var ap=aq.getContext("2d");ap.fillStyle=U.backgroundColor;ap.clearRect(0,0,w*(V+1),v*(V+1));ap.fillRect(0,0,w*(V+1),v*(V+1))}else{aq.textContent="";aq.style.backgroundColor=U.backgroundColor}});var ag=w,af;while(ag--){N[ag]=[];af=v;while(af--){N[ag][af]=true}}}else{var aa=document.createElement("canvas").getContext("2d");aa.fillStyle=U.backgroundColor;aa.fillRect(0,0,1,1);var aj=aa.getImageData(0,0,1,1).data;var al=Y.getContext("2d").getImageData(0,0,w*V,v*V).data;var ag=w,af,ad,ac,ak;while(ag--){N[ag]=[];af=v;while(af--){ac=V;singleGridLoop:while(ac--){ad=V;while(ad--){ak=4;while(ak--){if(al[((af*V+ac)*w*V+(ag*V+ad))*4+ak]!==aj[ak]){N[ag][af]=false;break singleGridLoop}}}}if(N[ag][af]!==false){N[ag][af]=true}}}al=aa=aj=undefined}if(U.hover||U.click){m=true;var ag=w+1;while(ag--){x[ag]=[]}if(U.hover){Y.addEventListener("mousemove",l)}if(U.click){Y.addEventListener("click",B)}Y.addEventListener("wordcloudstart",function ab(){Y.removeEventListener("wordcloudstart",ab);Y.removeEventListener("mousemove",l);Y.removeEventListener("click",B);D=undefined})}var ak=0;var an,Z;if(U.wait!==0){an=window.setTimeout;Z=window.clearTimeout}else{an=window.setImmediate;Z=window.clearImmediate}var ah=function ah(ap,aq){j.forEach(function(ar){ar.addEventListener(ap,aq)},this)};var ai=function ai(ap,aq){j.forEach(function(ar){ar.removeEventListener(ap,aq)},this)};var ao=function ao(){ai("wordcloudstart",ao);Z(ae)};ah("wordcloudstart",ao);$("#canvas-container span").remove();var ae=an(function am(){if(ak>=U.list.length){Z(ae);F("wordcloudstop",false);ai("wordcloudstart",ao);return}O=(new Date()).getTime();var aq=E(U.list[ak]);var ap=!F("wordclouddrawn",true,{item:U.list[ak],drawn:aq});if(G()||ap){Z(ae);U.abort();F("wordcloudabort",false);F("wordcloudstop",false);ai("wordcloudstart",ao);return}ak++;ae=an(am,U.wait)},U.wait)};A()};a.isSupported=c;a.miniumFontSize=b;if(typeof define==="function"&&define.amd){define("wordcloud",[],function(){return a})}else{d.WordCloud=a}})(this);